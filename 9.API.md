##API##

# Here we will be using Dynamo DB to give us api services

To integrate a visitor counter with Amazon DynamoDB, we'll create a simple API using AWS Lambda using Function URLS to handle the database interactions. Here's a overview of the steps.
Use function URLs to assign HTTP(S) endpoints to your Lambda function.

## Step 8: Setting Up AWS Lambda



2. **Create an IAM Role for Lambda:**
   - Go to the [IAM Console](https://console.aws.amazon.com/iam/).
   - Click on "Roles" and then "Create role."
   - Attach the `AWSLambdaBasicExecutionRole` policy.
   - Click on "Create role."

3. **Create a Lambda Function:**
   - Go to the [AWS Lambda Console](https://console.aws.amazon.com/lambda/).
   - Click on "Create function."
   - Choose "Author from scratch."
   - Configure the function:
     - Name: `cloudresume-test-api`
     - Runtime: Node.js 20.x
   - Under Advanced Setting we have to select Function URL. ( Use function URLs to assign HTTP(S) endpoints to your Lambda function. )
   - Select Auth type as none.
   - Select CORS Configure cross-origin resource sharing (CORS) option
     This function will be useful to limit the people who will access the function URL by default it is everyone.
   - Click on "Create function."
  

     <img width="1710" alt="Screenshot 2023-11-20 at 2 21 15â€¯PM" src="https://github.com/JoelSamson/Cloud-Resume-Challenge/assets/55976489/f6571067-26e0-4361-bf78-0b3ea690575c">
     <img width="1710" alt="Screenshot 2023-11-20 at 2 21 19â€¯PM" src="https://github.com/JoelSamson/Cloud-Resume-Challenge/assets/55976489/b60730eb-abca-4695-b55e-0149be88e502">
     <img width="1710" alt="Screenshot 2023-11-20 at 2 21 21â€¯PM" src="https://github.com/JoelSamson/Cloud-Resume-Challenge/assets/55976489/072a1016-f2f2-4e0f-93d7-82eb22427076">

4. **Check the function URL configuration:**
   - Inside your Lambda function, go to the "Configuration" tab.
   - Under "Function URL," find the "Allow Origin" section.
   - This has a value * means anyone can access it,
     <img width="1710" alt="Screenshot 2023-11-20 at 2 28 20â€¯PM" src="https://github.com/JoelSamson/Cloud-Resume-Challenge/assets/55976489/97daec24-91f2-464f-854c-dff586df0102">


5. **Write Lambda Function Code:**
   - Replace the existing code in your Lambda function with the code below:

```python
import json
import boto3

awsService = boto3.resource('dynamodb')
table = awsService.Table('cloudresume')

def lambda_handler(event, context):
    # TODO implement
    response = table.get_item(Key={
        'id':'1'
    })
    views = response['Item']['views']
    views = views + 1
    print(views)
    response = table.put_item(Item={
        'id':'1',
        'views': views
    })
    return views
```

6. **Test the lamda function**
   - First deploy it and then create a sample test.
   - Test the lamda functiom
    <img width="1710" alt="image" src="https://github.com/JoelSamson/Cloud-Resume-Challenge/assets/55976489/4deec712-ca49-4205-80e3-1f363a8aafd0">
   -
   
  


8. **Deploy API:**
   - After creating the API, go to the "Stages" tab.
   - Click on "Create."
   - Enter a name for the stage (e.g., `prod`) and click on "Create."

## Step 9: Update Frontend JavaScript

Update your existing `visitor-counter.js` file to fetch and update the visitor count from the new API.

```javascript
// visitor-counter.js

document.addEventListener('DOMContentLoaded', function () {
    const visitorCountElement = document.getElementById('visitor-count');

    // Fetch the initial visitor count from the API
    fetch('https://your-api-id.execute-api.your-region.amazonaws.com/prod/update-visitor-count')
        .then((response) => response.json())
        .then((data) => {
            currentVisitorCount = data.visitorCount;
            updateVisitorCount();
        })
        .catch((error) => console.error('Error fetching visitor count:', error));

    // Simulate an increase in visitor count
    setInterval(() => {
        fetch('https://your-api-id.execute-api.your-region.amazonaws.com/prod/update-visitor-count')
            .then((response) => response.json())
            .then((data) => {
                currentVisitorCount = data.visitorCount;
                updateVisitorCount();
            })
            .catch((error) => console.error('Error fetching visitor count:', error));
    }, 5000); // Update every 5 seconds

    function updateVisitorCount() {
        if (visitorCountElement) {
            visitorCountElement.textContent = `Total Visitors: ${currentVisitorCount}`;
        }
    }
});
```

Replace `'https://your-api-id.execute-api.your-region.amazonaws.com'` with the actual URL of your API Gateway.

## Step 10: Deploy and Test

1. Deploy your Lambda function and API Gateway changes.

2. Access your resume webpage, and you should see the visitor count updating dynamically, fetching and updating the count from DynamoDB through your Lambda function.

Remember to replace placeholder values (such as `your-api-id` and `your-region`) with your actual API Gateway information.

## Showcase Repository

For a detailed look at my implementation of the DynamoDB-backed visitor counter, check out my [GitHub repository](https://github.com/your-username/cloud-resume-challenge).

Feel free to reach out if you have any questions or need further assistance. Good luck with your resume development and DynamoDB integration! ðŸš€
