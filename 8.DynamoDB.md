# Implementing a Visitor Counter with Amazon DynamoDB

To integrate a visitor counter with Amazon DynamoDB, we'll create a simple backend API using AWS Lambda and API Gateway to handle the database interactions. Here's a high-level overview of the steps:

## Step 8: Setting Up DynamoDB and AWS Lambda

1. **Create a DynamoDB Table:**
   - Go to the [Amazon DynamoDB Console](https://console.aws.amazon.com/dynamodb/).
   - Click on "Create table."
   - Enter a table name (e.g., `cloudresume`).
   - Set the primary key as `id` (String).
   - Click on "Create."
  <img width="1710" alt="Screenshot 2023-11-20 at 2 06 08â€¯PM" src="https://github.com/JoelSamson/Cloud-Resume-Challenge/assets/55976489/9be86953-898e-4701-8d65-58ce0fe936b1">
   <img width="1710" alt="Screenshot 2023-11-20 at 2 06 12â€¯PM" src="https://github.com/JoelSamson/Cloud-Resume-Challenge/assets/55976489/348ad624-ed59-489c-9787-33e30efa822f">


2. **Create an IAM Role for Lambda:**
   - Go to the [IAM Console](https://console.aws.amazon.com/iam/).
   - Click on "Roles" and then "Create role."
   - Attach the `AWSLambdaBasicExecutionRole` policy.
   - Click on "Create role."

3. **Create a Lambda Function:**
   - Go to the [AWS Lambda Console](https://console.aws.amazon.com/lambda/).
   - Click on "Create function."
   - Choose "Author from scratch."
   - Configure the function:
     - Name: `VisitorCounterFunction`
     - Runtime: Node.js 14.x
     - Role: Choose an existing role and select the IAM role created earlier.
   - Click on "Create function."

4. **Configure Environment Variables for Lambda:**
   - Inside your Lambda function, go to the "Configuration" tab.
   - Under "Function code," find the "Environment variables" section.
   - Add the following environment variables:
     - `DYNAMODB_TABLE_NAME`: `VisitorCounter`
     - `REGION`: Your AWS region (e.g., `us-east-1`).

5. **Write Lambda Function Code:**
   - Replace the existing code in your Lambda function with the code below:

```javascript
// index.js

const AWS = require('aws-sdk');

const dynamodb = new AWS.DynamoDB.DocumentClient();

exports.handler = async (event) => {
    try {
        const result = await updateVisitorCount();
        return {
            statusCode: 200,
            body: JSON.stringify(result),
        };
    } catch (error) {
        return {
            statusCode: 500,
            body: JSON.stringify({ error: 'Internal Server Error' }),
        };
    }
};

async function updateVisitorCount() {
    const params = {
        TableName: process.env.DYNAMODB_TABLE_NAME,
        Key: { id: 'totalVisitors' },
        UpdateExpression: 'ADD visitorCount :val',
        ExpressionAttributeValues: { ':val': 1 },
        ReturnValues: 'UPDATED_NEW',
    };

    const result = await dynamodb.update(params).promise();
    return { visitorCount: result.Attributes.visitorCount };
}
```

6. **Create an API Gateway:**
   - Go to the [Amazon API Gateway Console](https://console.aws.amazon.com/apigateway/).
   - Click on "Create API."
   - Choose "HTTP API" and click on "Build" under "Configure routes."
   - Add a route:
     - Resource: `/update-visitor-count`
     - Lambda integration: Choose your Lambda function.
   - Click on "Next" and then "Create."

7. **Deploy API:**
   - After creating the API, go to the "Stages" tab.
   - Click on "Create."
   - Enter a name for the stage (e.g., `prod`) and click on "Create."

## Step 9: Update Frontend JavaScript

Update your existing `visitor-counter.js` file to fetch and update the visitor count from the new API.

```javascript
// visitor-counter.js

document.addEventListener('DOMContentLoaded', function () {
    const visitorCountElement = document.getElementById('visitor-count');

    // Fetch the initial visitor count from the API
    fetch('https://your-api-id.execute-api.your-region.amazonaws.com/prod/update-visitor-count')
        .then((response) => response.json())
        .then((data) => {
            currentVisitorCount = data.visitorCount;
            updateVisitorCount();
        })
        .catch((error) => console.error('Error fetching visitor count:', error));

    // Simulate an increase in visitor count
    setInterval(() => {
        fetch('https://your-api-id.execute-api.your-region.amazonaws.com/prod/update-visitor-count')
            .then((response) => response.json())
            .then((data) => {
                currentVisitorCount = data.visitorCount;
                updateVisitorCount();
            })
            .catch((error) => console.error('Error fetching visitor count:', error));
    }, 5000); // Update every 5 seconds

    function updateVisitorCount() {
        if (visitorCountElement) {
            visitorCountElement.textContent = `Total Visitors: ${currentVisitorCount}`;
        }
    }
});
```

Replace `'https://your-api-id.execute-api.your-region.amazonaws.com'` with the actual URL of your API Gateway.

## Step 10: Deploy and Test

1. Deploy your Lambda function and API Gateway changes.

2. Access your resume webpage, and you should see the visitor count updating dynamically, fetching and updating the count from DynamoDB through your Lambda function.

Remember to replace placeholder values (such as `your-api-id` and `your-region`) with your actual API Gateway information.

## Showcase Repository

For a detailed look at my implementation of the DynamoDB-backed visitor counter, check out my [GitHub repository](https://github.com/your-username/cloud-resume-challenge).

Feel free to reach out if you have any questions or need further assistance. Good luck with your resume development and DynamoDB integration! ðŸš€
